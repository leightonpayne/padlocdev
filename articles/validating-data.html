<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="padlocdev">
<title>Validating padloc-db data • padlocdev</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validating padloc-db data">
<meta property="og:description" content="padlocdev">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">padlocdev</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/padlocdev.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/preparing-data.html">Preparing padloc-db data for use</a>
    <a class="dropdown-item" href="../articles/reading-data.html">Reading padloc-db data</a>
    <a class="dropdown-item" href="../articles/validating-data.html">Validating padloc-db data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/leightonpayne/padlocdev/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Validating padloc-db data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/leightonpayne/padlocdev/blob/HEAD/vignettes/validating-data.Rmd" class="external-link"><code>vignettes/validating-data.Rmd</code></a></small>
      <div class="d-none name"><code>validating-data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leightonpayne/padlocdev" class="external-link">padlocdev</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="expanding-hmm-metadata-table">Expanding HMM metadata table<a class="anchor" aria-label="anchor" href="#expanding-hmm-metadata-table"></a>
</h3>
<p>The raw HMM metadata table read-in by <code><a href="../reference/read_hmm_meta.html">read_hmm_meta()</a></code>
can have multiple names listed in <code>protein.name</code> and
<code>secondary.name</code> (separated by the delimiter <code>|</code>).
To split these assignments into multiple rows, use
<code>expand_hmm_meta()</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/padlocdev_example.html">padlocdev_example</a></span><span class="op">(</span><span class="st">"hmm_meta.txt"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/read_hmm_meta.html">read_hmm_meta</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hmm_meta_expanded</span> <span class="op">&lt;-</span> <span class="fu">expand_hmm_meta</span><span class="op">(</span><span class="va">hmm_meta</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in expand_hmm_meta(hmm_meta): could not find function "expand_hmm_meta"</span></span></code></pre></div>
<p>The HMM metadata table can be re-collapsed using
<code>collapse_hmm_meta()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_meta_collapsed</span> <span class="op">&lt;-</span> <span class="fu">collapse_hmm_meta</span><span class="op">(</span><span class="va">hmm_meta_expanded</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in collapse_hmm_meta(hmm_meta_expanded): could not find function "collapse_hmm_meta"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expanding-secondary-gene-assignments">Expanding secondary gene assignments<a class="anchor" aria-label="anchor" href="#expanding-secondary-gene-assignments"></a>
</h3>
<p>Raw system model files can contain references to gene groups a.k.a
<code>secondary.name</code> assignments. Before testing model validity,
these gene groups need to be expanded.</p>
<p>First, read in the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/padlocdev_example.html">padlocdev_example</a></span><span class="op">(</span><span class="st">"sys/SystemA_III.yaml"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/read_padloc_model.html">read_padloc_model</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><code>SystemA_III</code> has one ‘<code>gene</code>’ in
<code>optional_genes</code> i.e. <code>Sya_accessory</code> which is
actually a group of genes.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">[[</span><span class="st">"optional_genes"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "Sya_accessory"</span></span></code></pre></div>
<p>Use <code><a href="../reference/expand_gene_groups.html">expand_gene_groups()</a></code> to expand gene groups for a
particuar gene category, based on the <code>secondary.name</code>
assignments in the HMM metadata table.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand_gene_groups.html">expand_gene_groups</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"optional_genes"</span>, <span class="va">hmm_meta_expanded</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in dplyr::select(hmm_meta, "protein.name", "secondary.name"): object 'hmm_meta_expanded' not found</span></span>
<span><span class="va">genes</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'genes' not found</span></span></code></pre></div>
<p>These can be assigned back onto the model. Other genes that are
listed and not part of a gene group also get carried over.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">[[</span><span class="st">"optional_genes"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">genes</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'genes' not found</span></span></code></pre></div>
<p>A wrapper is provided to expand the gene assignments for all gene
categories of all system models in a list.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/padlocdev_example.html">padlocdev_example</a></span><span class="op">(</span><span class="st">"sys"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/multi_read_padloc_model.html">multi_read_padloc_model</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">models_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand_gene_groups_all.html">expand_gene_groups_all</a></span><span class="op">(</span><span class="va">models</span>, <span class="va">hmm_meta_expanded</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in dplyr::select(hmm_meta, "protein.name", "secondary.name"): object 'hmm_meta_expanded' not found</span></span>
<span><span class="va">models_expanded</span><span class="op">[[</span><span class="st">"SystemA_III"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"optional_genes"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'models_expanded' not found</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checking-that-system-models-are-valid">Checking that system models are valid<a class="anchor" aria-label="anchor" href="#checking-that-system-models-are-valid"></a>
</h3>
<p><code><a href="../reference/valid_padloc_model_basic.html">valid_padloc_model_basic()</a></code> and
<code><a href="../reference/valid_padloc_model_expanded.html">valid_padloc_model_expanded()</a></code> are used for assessing model
validity. Each function provides useful error information for fixing a
model if it is invalid.</p>
<p><code><a href="../reference/valid_padloc_model_basic.html">valid_padloc_model_basic()</a></code> is run automatically upon
reading a padloc model, it does basic type checking but no assessment of
duplicated genes, overlap between gene categories, or validation of gene
number requirements, as at this initial stage, some genes may actually
be gene groups.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/valid_padloc_model_basic.html">valid_padloc_model_basic</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="st">"SystemA_III"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>While <code><a href="../reference/valid_padloc_model_basic.html">valid_padloc_model_basic()</a></code> returns
<code>TRUE</code> for <code>SystemA_III</code> before expansion of gene
groups, the model for <code>SystemA_III</code> should technically be
invalid, as the <code>minimum_total</code> is <code>3</code>, but only
two types of genes are listed in total i.e. <code>SyaA</code> and
<code>Sya_accessory</code> (in reality, we know already that
<code>Sya_accessory</code> actually represents two genes,
<code>SyaB</code> and <code>SyaC</code>).</p>
<p><code><a href="../reference/valid_padloc_model_expanded.html">valid_padloc_model_expanded()</a></code> should be run after
expanding the gene groups of a model to perform additional validation
checks.</p>
<p>For example’s sake, <code><a href="../reference/valid_padloc_model_expanded.html">valid_padloc_model_expanded()</a></code> fails
(as expected) on the unexpanded version of <code>SystemA_III</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/valid_padloc_model_expanded.html">valid_padloc_model_expanded</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="st">"SystemA_III"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `valid_padloc_model_expanded()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Invalid padloc system model:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> `minimum_total` must be &lt;= the combined number of `core_genes` and</span></span>
<span><span class="co">#&gt; `optional_genes`.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> `minimum_total` is <span style="color: #0000BB;">3</span>, but `core_genes` + `optional_genes` is <span style="color: #0000BB;">2</span></span></span></code></pre></div>
<p>But it passes (as expected) on the expanded version.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/valid_padloc_model_expanded.html">valid_padloc_model_expanded</a></span><span class="op">(</span><span class="va">models_expanded</span><span class="op">[[</span><span class="st">"SystemA_III"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in subset(padloc_model$core_genes, padloc_model$core_genes != "NA"): object 'models_expanded' not found</span></span></code></pre></div>
<p>The wrapper <code><a href="../reference/report_padloc_model_validity.html">report_padloc_model_validity()</a></code> is provided
to test the validity of all system models in a list and return the
output as a <code>list</code> of <code>?purrr::safely()</code> style
sub-<code>list</code>s with two components <code>result</code> and
<code>error</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validity_report</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/report_padloc_model_validity.html">report_padloc_model_validity</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span></span></code></pre></div>
<p>For each model, if it is valid, <code>result</code> is
<code>TRUE</code> and <code>error</code> is <code>NULL</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validity_report</span><span class="op">[[</span><span class="st">"SystemA_I"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; $result</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $error</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>If the model is invalid, <code>result</code> is <code>FALSE</code>
and <code>error</code> is an <code><a href="https://rlang.r-lib.org/reference/rlang_error.html" class="external-link">?rlang::rlang_error</a></code> object
that describes the reason the model is invalid.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validity_report</span><span class="op">[[</span><span class="st">"SystemA_III"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; $result</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $error</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">&lt;error/rlang_error&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;">:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Invalid padloc system model:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> `minimum_total` must be &lt;= the combined number of `core_genes` and</span></span>
<span><span class="co">#&gt; `optional_genes`.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> `minimum_total` is <span style="color: #0000BB;">3</span>, but `core_genes` + `optional_genes` is <span style="color: #0000BB;">2</span></span></span></code></pre></div>
<p>To return just the error messages for all model in the list, use
<code><a href="../reference/why_invalid.html">why_invalid()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/why_invalid.html">why_invalid</a></span><span class="op">(</span><span class="va">validity_report</span><span class="op">)</span></span>
<span><span class="co">#&gt; $SystemA_III</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">&lt;error/rlang_error&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;">:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Invalid padloc system model:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> `minimum_total` must be &lt;= the combined number of `core_genes` and</span></span>
<span><span class="co">#&gt; `optional_genes`.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> `minimum_total` is <span style="color: #0000BB;">3</span>, but `core_genes` + `optional_genes` is <span style="color: #0000BB;">2</span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Leighton Payne.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
